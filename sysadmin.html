
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Deployment Documentation &#8212; MedCo Technical Documentation 0.1 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Description of Deployments" href="sysadmin/deployments.html" />
    <link rel="prev" title="User Documentation" href="user.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="sysadmin/deployments.html" title="Description of Deployments"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="user.html" title="User Documentation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">MedCo Technical Documentation 0.1 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="deployment-documentation">
<h1>Deployment Documentation<a class="headerlink" href="#deployment-documentation" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="sysadmin/deployments.html">Description of Deployments</a><ul>
<li class="toctree-l2"><a class="reference internal" href="sysadmin/deployments.html#medco-configuration-folder">MedCo Configuration Folder</a><ul>
<li class="toctree-l3"><a class="reference internal" href="sysadmin/deployments.html#configuration-files-specific-to-a-node">Configuration Files specific to a node</a></li>
<li class="toctree-l3"><a class="reference internal" href="sysadmin/deployments.html#configuration-generation-tool">Configuration Generation Tool</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="sysadmin/deployments.html#services-docker-containers">Services (Docker Containers)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="sysadmin/deployments.html#i2b2-server">i2b2-server</a></li>
<li class="toctree-l3"><a class="reference internal" href="sysadmin/deployments.html#i2b2-web">i2b2-web</a></li>
<li class="toctree-l3"><a class="reference internal" href="sysadmin/deployments.html#shrine-server">shrine-server</a></li>
<li class="toctree-l3"><a class="reference internal" href="sysadmin/deployments.html#unlynx">unlynx</a></li>
<li class="toctree-l3"><a class="reference internal" href="sysadmin/deployments.html#i2b2-database">i2b2-database</a></li>
<li class="toctree-l3"><a class="reference internal" href="sysadmin/deployments.html#shrine-database">shrine-database</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<p>todo: change files and names to deployments
todo: change structure of whole thing</p>
<blockquote>
<div>How to deploy and configure MedCo</div></blockquote>
<p>deploy-install
configuration–use of conf generation (what it does is in deployment)
system administration
description of deployment</p>
<p>3 nodes on a local machine</p>
<p>docker version
tested on debian jessie</p>
<p>compose-profile, matching configuration profile: explain
quick start guide</p>
<div class="section" id="deploying-medco-on-a-single-server">
<h2>Deploying MedCo on a Single Server<a class="headerlink" href="#deploying-medco-on-a-single-server" title="Permalink to this headline">¶</a></h2>
<p>This short guide will show you how to deploy 3 nodes of the full MedCo stack on a single machine with the help of Docker and Docker-Compose.
Any kind of not too old Linux flavor should work, but it has only be tested on the following configuration:</p>
<ul class="simple">
<li>Operating System: Ubuntu 14.04.5 LTS, assumed to be freshly installed and up to date.</li>
<li>Pre-requisite software: <em>git</em> (the rest of the dependencies will be automatically installed with a script).</li>
</ul>
<p>First step is to clone the <code class="docutils literal"><span class="pre">medco-deployment</span></code> repository and to execute the script that will install the dependencies on your machine.
Among others, it will install Docker 17.12.0-ce and Docker-Compose 1.14.0.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git clone https://c4science.ch/source/medco-deployment.git
$ bash medco-deployment/resources/utility-scripts/ubuntu_prereqs_setup.sh
</pre></div>
</div>
<p>Next step is to build the docker images. They will be built from source, for this reason the very first build might
take a lot of time depending on the perfomance of your machine (up to 2 hours on a standard laptop, around 20 minutes on a powerful server).
In this specific case (i.e. 3 nodes running on a single machine) you can use the provided compose and configuration profiles, called <code class="docutils literal"><span class="pre">dev-3nodes-samehost</span></code>.
As it name indicates, it is for development purposes, runs 3 nodes on a single server.</p>
<p>This command will build the first node from scratch:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> medco-deployment/compose-profiles/dev-3nodes-samehost
$ docker-compose -f docker-compose-srv0.yml build
</pre></div>
</div>
<p>Because Docker will cache the images built at the previous step, building the 2 other nodes will be much faster:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ docker-compose -f docker-compose-srv1.yml build
$ docker-compose -f docker-compose-srv2.yml build
</pre></div>
</div>
<p>Next step is to run the nodes. They need to be running in parallel, and the logs of the running containers will maintain the console captive.
For this reason it is recommended to use <em>screen</em> to run them. Use <code class="docutils literal"><span class="pre">screen</span> <span class="pre">-dRR</span></code> to start a new screen session.
<code class="docutils literal"><span class="pre">Ctrl+A-C</span></code> will create a new window: create at least 3 of them. <code class="docutils literal"><span class="pre">Ctrl+A-P</span></code> and <code class="docutils literal"><span class="pre">Ctrl+A-N</span></code> allow to navigate between the windows.
Hit simply <code class="docutils literal"><span class="pre">Ctrl+D</span></code> to close the current window. Use <code class="docutils literal"><span class="pre">Ctrl+A-D</span></code> to detach from the screen instance. Once detached you are back in the normal console
and can simply run again <code class="docutils literal"><span class="pre">screen</span> <span class="pre">-dRR</span></code> to attach to the running screen session.</p>
<p>Run the first node:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ docker-compose -f docker-compose-srv0.yml up
</pre></div>
</div>
<p>In a separate <em>screen</em> window the second:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ docker-compose -f docker-compose-srv1.yml up
</pre></div>
</div>
<p>And in another separate window the last one:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ docker-compose -f docker-compose-srv2.yml up
</pre></div>
</div>
<p>The first time each of the node runs, the database will be initialized with the structure and the i2b2 demo data,
it will take a few minutes so do not interrupt this loading!
The next times the nodes are ran, they take 1-2 minutes to be up and running. In order to stop a node,
simply hit <code class="docutils literal"><span class="pre">Ctrl+C</span></code> in window where the node is active.</p>
<p><strong>Important note about the ports used when running several nodes a single host</strong></p>
<p>Since they are running on the same host, the ports used for the different services had to be adapted.
The modification follow the following logic: if the port is specified as being <code class="docutils literal"><span class="pre">80</span></code> on the documentation,
the port exposed on the host for the first node will be <code class="docutils literal"><span class="pre">82</span></code>, for the second node <code class="docutils literal"><span class="pre">84</span></code>, and for the third <code class="docutils literal"><span class="pre">86</span></code>.
That is, they are incremented by 2 for every node.</p>
<p><strong>Testing that the nodes are working</strong></p>
<p>In order to test that a <em>single node</em> is working, you can access the index page at <code class="docutils literal"><span class="pre">&lt;your_server_address&gt;:82</span></code> and
click on the <code class="docutils literal"><span class="pre">I2b2</span> <span class="pre">Webclient</span></code> link (or another port for another node).
Connect with the default credentials (<code class="docutils literal"><span class="pre">demo</span></code> and <code class="docutils literal"><span class="pre">prigen2017</span></code>), construct and run any query on the i2b2 demo data.</p>
<p>The demo data for MedCo needs a specific loading process covered on a separate guide, but if you have loaded them already,
you can run the <code class="docutils literal"><span class="pre">SHRINE-MedCo</span> <span class="pre">Webclient</span></code> from the index page (default credentials <code class="docutils literal"><span class="pre">medcoshrineuser</span></code> and <code class="docutils literal"><span class="pre">prigen2017</span></code>),
select the MedCo plugin via the link on the top-right, and construct and run a query.</p>
<p>Another way to check is by accessing the <code class="docutils literal"><span class="pre">SHRINE</span> <span class="pre">Dashboard</span></code> from the index page (default credentials <code class="docutils literal"><span class="pre">medcoadmin</span></code> and <code class="docutils literal"><span class="pre">prigen2017</span></code>).</p>
</div>
<div class="section" id="deploying-medco-on-separate-servers">
<h2>Deploying MedCo on Separate Servers<a class="headerlink" href="#deploying-medco-on-separate-servers" title="Permalink to this headline">¶</a></h2>
<p>similar
build and run: same as for one instance, but docker commands need to be on each server</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="user.html"
                        title="previous chapter">User Documentation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="sysadmin/deployments.html"
                        title="next chapter">Description of Deployments</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="sysadmin/deployments.html" title="Description of Deployments"
             >next</a> |</li>
        <li class="right" >
          <a href="user.html" title="User Documentation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">MedCo Technical Documentation 0.1 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, EPFL LCA1.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.5.
    </div>
  </body>
</html>