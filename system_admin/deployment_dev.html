

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Development Deployment (several nodes on a single machine) &mdash; MedCo Technical Documentation 0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Test Deployment (one node per machine)" href="deployment_test.html" />
    <link rel="prev" title="System Administrator Guide" href="index.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> MedCo Technical Documentation
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">System Administrator Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Development Deployment (several nodes on a single machine)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#docker-deployment">Docker Deployment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#keycloak-configuration">Keycloak Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing-that-the-nodes-are-working">Testing that the nodes are working</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="deployment_test.html">Test Deployment (one node per machine)</a></li>
<li class="toctree-l2"><a class="reference internal" href="loading_data.html">Loading Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#deployment-profiles">Deployment profiles</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MedCo Technical Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">System Administrator Guide</a> &raquo;</li>
        
      <li>Development Deployment (several nodes on a single machine)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/system_admin/deployment_dev.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="development-deployment-several-nodes-on-a-single-machine">
<span id="lbl-deployment-dev"></span><h1>Development Deployment (several nodes on a single machine)<a class="headerlink" href="#development-deployment-several-nodes-on-a-single-machine" title="Permalink to this headline">¶</a></h1>
<div class="section" id="docker-deployment">
<h2>Docker Deployment<a class="headerlink" href="#docker-deployment" title="Permalink to this headline">¶</a></h2>
<p>This short guide will show you how to deploy 3 nodes of the full MedCo stack on a single machine with the help of Docker and Docker-Compose, for development purpose, or test on a single machine.
Any kind of not too old Linux flavor should work, but it has only be tested on the following configuration:</p>
<ul class="simple">
<li>Operating System: Ubuntu 16.04 LTS or Fedora 29, assumed to be freshly installed and up to date.</li>
<li>Pre-requisite software: <em>git</em>, <em>git-lfs</em>, <em>docker</em> and <em>docker-compose</em> (the rest of the dependencies will be automatically installed with a script).</li>
</ul>
<p>First step is to clone the <code class="docutils literal notranslate"><span class="pre">medco-deployment</span></code>, <code class="docutils literal notranslate"><span class="pre">IRCT</span></code> and <code class="docutils literal notranslate"><span class="pre">glowing-bear</span></code> repositories (with the correct branch).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~
$ git clone -b v0.1 https://github.com/lca1/medco-deployment.git
$ git clone -b MedCo-v0.1 https://github.com/lca1/IRCT.git
$ git clone -b MedCo-v0.1 https://github.com/lca1/glowing-bear.git
</pre></div>
</div>
<p>Next step is to build or download the docker images.
In this specific case (i.e. 3 nodes running on a single machine) you can use the provided compose and configuration profiles, called <code class="docutils literal notranslate"><span class="pre">dev-3nodes-1host</span></code>.
As the name indicates, it is mainly done for development purposes and runs 3 nodes on a single host machine.</p>
<p>Some images are available in docker hub. To get them simply:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/medco-deployment/compose-profiles/dev-3nodes-1host
$ docker-compose -f docker-compose.yml pull
</pre></div>
</div>
<p>For the others, they need to be built by doing the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/IRCT/deployments
$ docker-compose -f docker-compose.medco.dev-3nodes-1host.yml build
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/glowing-bear/deployment
$ docker-compose -f docker-compose.yml build gb-dev-server
</pre></div>
</div>
<p>Next step is to run the nodes. They will run simultaneously, and the logs of the running containers will maintain the console captive.
No configuration changes are needed in this scenario before running the nodes.
To run them:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/medco-deployment/compose-profiles/dev-3nodes-1host
$ docker-compose up
</pre></div>
</div>
<p>Wait a few minutes for the initialization of the containers to be done (until the logging stops).
For the subsequent runs, the startup will be faster.
Then, in a separate terminal run the IRCT container:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/IRCT/deployments
$ chmod -R a+rw ../
$ docker-compose -f docker-compose.medco.dev-3nodes-1host.yml up
</pre></div>
</div>
<p>Again, the initial startup takes up a few minutes.
And in another separate terminal run the glowing-bear container:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/glowing-bear/deployment
$ docker-compose -f docker-compose.yml up gb-dev-server
</pre></div>
</div>
<p>The first time each of the node runs, the database will be initialized with the structure and the i2b2 demo data.
It will take a few minutes so do not interrupt this loading!
The next times the nodes are ran, they take 1-2 minutes to be up and running. In order to stop all the nodes,
simply hit <code class="docutils literal notranslate"><span class="pre">Ctrl+C</span></code> in all the active windows.</p>
<p>If you wish to stop a single node, just manually stop each node’s containers.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/medco-deployment/compose-profiles/dev-3nodes-1host
$ docker-compose stop i2b2-medco-srvX nginx-srvX php-fpm-srvX medco-unlynx-srvX
</pre></div>
</div>
<p>All the services are now up and running, a service still needs some configuration.</p>
</div>
<div class="section" id="keycloak-configuration">
<h2>Keycloak Configuration<a class="headerlink" href="#keycloak-configuration" title="Permalink to this headline">¶</a></h2>
<p>Access in your browser the address <code class="docutils literal notranslate"><span class="pre">http://localhost:8081/auth/admin</span></code> and connect with the default credentials:
user <code class="docutils literal notranslate"><span class="pre">keycloak</span></code> and password <code class="docutils literal notranslate"><span class="pre">keycloak</span></code>.</p>
<p><strong>Add a test user</strong>: go to the configuration panel <em>Users</em>, click on <em>Add user</em>.
Then fill the <em>Username</em> with <code class="docutils literal notranslate"><span class="pre">test</span></code>, toggle to <code class="docutils literal notranslate"><span class="pre">ON</span></code> the <em>Email Verified</em> button and click <em>Save</em>.
In the next window, click on <em>Credentials</em>, enter twice the password <code class="docutils literal notranslate"><span class="pre">test</span></code>, toggle to <code class="docutils literal notranslate"><span class="pre">OFF</span></code> the <em>Temporary</em> button and click <em>Reset Password</em>.</p>
<p><strong>Add an OpenID Connect client configuration</strong>: go to the configuration panel <em>Clients</em>, click on <em>Create</em>.
There specify in <em>Client ID</em> the value <code class="docutils literal notranslate"><span class="pre">i2b2-local</span></code> and click <em>Save</em>.
In the next window, fill <em>Valid Redirect URIs</em> and <em>Web Origins</em> with the value <code class="docutils literal notranslate"><span class="pre">http://localhost:4200</span></code> and click <em>Save</em>.</p>
</div>
<div class="section" id="testing-that-the-nodes-are-working">
<h2>Testing that the nodes are working<a class="headerlink" href="#testing-that-the-nodes-are-working" title="Permalink to this headline">¶</a></h2>
<p>In order to test that the development deployment of MedCo is working, access Glowing Bear at <code class="docutils literal notranslate"><span class="pre">localhost:4200</span></code>.
Use the credentials previously configured: user <code class="docutils literal notranslate"><span class="pre">test</span></code> and password <code class="docutils literal notranslate"><span class="pre">test</span></code>.</p>
<p>By default MedCo contains only those test data, refer to <a class="reference internal" href="../developer/test_data_description.html#lbl-test-data-description"><span class="std std-ref">Description of the default test data</span></a> for expected results to queries.
To load a data set, follow the guide <a class="reference internal" href="loading_data.html#lbl-loading-data"><span class="std std-ref">Loading Data</span></a>.
The database address to use is <code class="docutils literal notranslate"><span class="pre">localhost:5432</span></code> with the databases <code class="docutils literal notranslate"><span class="pre">i2b2medcosrv0</span></code>, <code class="docutils literal notranslate"><span class="pre">i2b2medcosrv1</span></code> and <code class="docutils literal notranslate"><span class="pre">i2b2medcosrv2</span></code>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="deployment_test.html" class="btn btn-neutral float-right" title="Test Deployment (one node per machine)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="System Administrator Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2018, EPFL LCA1

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'0.1',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>