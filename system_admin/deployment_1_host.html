

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Deploying MedCo on a Single Server &mdash; MedCo 0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Deploying MedCo on Multiple Servers" href="deployment_multiple_hosts.html" />
    <link rel="prev" title="System Administrator Guide" href="index.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> MedCo
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">System Administrator Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Deploying MedCo on a Single Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment_multiple_hosts.html">Deploying MedCo on Multiple Servers</a></li>
<li class="toctree-l2"><a class="reference internal" href="loading_data.html">Loading Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MedCo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">System Administrator Guide</a> &raquo;</li>
        
      <li>Deploying MedCo on a Single Server</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/system_admin/deployment_1_host.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="deploying-medco-on-a-single-server">
<span id="lbl-deploy-single-server"></span><h1>Deploying MedCo on a Single Server<a class="headerlink" href="#deploying-medco-on-a-single-server" title="Permalink to this headline">¶</a></h1>
<p>This short guide will show you how to deploy 3 nodes of the full MedCo stack on a single machine with the help of Docker and Docker-Compose.
Any kind of not too old Linux flavor should work, but it has only be tested on the following configuration:</p>
<ul class="simple">
<li>Operating System: Ubuntu 16.04 LTS, assumed to be freshly installed and up to date.</li>
<li>Pre-requisite software: <em>git</em> (the rest of the dependencies will be automatically installed with a script).</li>
</ul>
<p>First step is to clone the <code class="docutils literal notranslate"><span class="pre">medco-deployment</span></code>, <code class="docutils literal notranslate"><span class="pre">IRCT</span></code> and <code class="docutils literal notranslate"><span class="pre">glowing-bear</span></code> repositories (with the correct branch) and to execute the script that will install the dependencies on your machine.
Among others, it will install Docker 18.06.0-ce and Docker-Compose 1.23.0.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~
$ git clone https://github.com/lca1/medco-deployment.git
$ git clone -b fork/thehyve https://github.com/lca1/IRCT.git
$ git clone -b picsure https://github.com/lca1/glowing-bear.git
$ bash ~/medco-deployment/resources/utility-scripts/ubuntu_prereqs_setup.sh
</pre></div>
</div>
<p>Next step is to build or download the docker images.
In this specific case (i.e. 3 nodes running on a single machine) you can use the provided compose and configuration profiles, called <code class="docutils literal notranslate"><span class="pre">dev-3nodes-1host</span></code>.
As the name indicates, it is mainly done for development purposes and runs 3 nodes on a single host machine.</p>
<p>Some images are available in docker hub. To get them simply:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/medco-deployment/compose-profiles/dev-3nodes-1host
$ docker-compose -f docker-compose.yml pull
</pre></div>
</div>
<p>For the others, they need to be built by doing the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/IRCT/deployments
$ docker-compose -f docker-compose.medco.dev-3nodes-1host.yml build
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/glowing-bear/deployment
$ docker-compose -f docker-compose.yml build gb-dev-server
</pre></div>
</div>
<p>Next step is to run the nodes. They will run simultaneously, and the logs of the running containers will maintain the console captive.
For this reason it is recommended to use <em>screen</em> to run them. Use <code class="docutils literal notranslate"><span class="pre">screen</span> <span class="pre">-dRR</span></code> to start a new screen session.
<code class="docutils literal notranslate"><span class="pre">Ctrl+A-C</span></code> will create a new window: create at least 3 of them. <code class="docutils literal notranslate"><span class="pre">Ctrl+A-P</span></code> and <code class="docutils literal notranslate"><span class="pre">Ctrl+A-N</span></code> allow to navigate between the windows.
Hit simply <code class="docutils literal notranslate"><span class="pre">Ctrl+D</span></code> to close the current window. Use <code class="docutils literal notranslate"><span class="pre">Ctrl+A-D</span></code> to detach from the screen instance. Once detached you are back in the normal console
and can simply run again <code class="docutils literal notranslate"><span class="pre">screen</span> <span class="pre">-dRR</span></code> to attach to the running screen session.</p>
<p>No configuration changes are needed in that case.
Run the nodes:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/medco-deployment/compose-profiles/dev-3nodes-1host
$ docker-compose -f docker-compose.yml up
</pre></div>
</div>
<p>In a separate <em>screen</em> window run the IRCT container:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/IRCT/deployments
$ docker-compose -f docker-compose.medco.dev-3nodes-1host.yml up
</pre></div>
</div>
<p>And in another separate window run the glowing-bear container:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/glowing-bear/deployment
$ docker-compose -f docker-compose.yml up gb-dev-server
</pre></div>
</div>
<p>The first time each of the node runs, the database will be initialized with the structure and the i2b2 demo data.
It will take a few minutes so do not interrupt this loading!
The next times the nodes are ran, they take 1-2 minutes to be up and running. In order to stop all the nodes,
simply hit <code class="docutils literal notranslate"><span class="pre">Ctrl+C</span></code> in all the active windows. If you wish to stop a single node, just manually stop each node’s containers.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker stop dev-3nodes-1host_i2b2-medco-srvX dev-3nodes-1host_unlynx-srv1X dev-3nodes-1host_web-srvX
</pre></div>
</div>
<p><strong>Important note about the ports used when running several nodes a single host</strong></p>
<p>Since they are running on the same host, the ports used for the different services had to be adapted.
The modification follows the following logic: if the port is specified as being <code class="docutils literal notranslate"><span class="pre">80</span></code> on the documentation,
the port exposed on the host for the first node will be <code class="docutils literal notranslate"><span class="pre">82</span></code>, for the second node <code class="docutils literal notranslate"><span class="pre">84</span></code>, and for the third <code class="docutils literal notranslate"><span class="pre">86</span></code>.
That is, they are incremented by 2 for every node.</p>
<p><strong>Testing that the nodes are working</strong></p>
<p>In order to test that a <em>single node</em> is working, you can access the index page at <code class="docutils literal notranslate"><span class="pre">&lt;your_server_address&gt;:82</span></code> and
click on the .
Connect with the default credentials ( and ), construct and run any query on the i2b2 demo data.</p>
<p>The test data for MedCo needs a specific loading process covered on a separate guide, <a class="reference internal" href="loading_data.html#lbl-loading-data"><span class="std std-ref">Loading Data</span></a>.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="deployment_multiple_hosts.html" class="btn btn-neutral float-right" title="Deploying MedCo on Multiple Servers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="System Administrator Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, EPFL LCA1

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'0.1',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>